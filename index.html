<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>UNO Online</title>
<style>
body{
  font-family:Arial;
  background:#0b6623;
  color:white;
  text-align:center;
}
button{
  padding:8px 15px;
  margin:5px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.card{
  display:inline-block;
  width:60px;
  height:90px;
  border-radius:10px;
  margin:5px;
  line-height:90px;
  font-weight:bold;
  color:white;
}
.red{background:#e53935;}
.blue{background:#1e88e5;}
.green{background:#43a047;}
.yellow{background:#fdd835;color:black;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <h2>UNO Game</h2>
  <input id="nameInput" placeholder="Masukkan Nama">
  <br><br>
  <button onclick="startOnline()">Online Multiplayer</button>
  <button onclick="startBot()">Lawan Bot</button>
</div>

<!-- GAME -->
<div id="game" style="display:none;">
  <h2>UNO 4 Player</h2>
  <div id="turnInfo"></div>
  <div id="players"></div>
  <h3>Discard:</h3>
  <div id="discard"></div>
  <h3>Kartu Kamu:</h3>
  <div id="myHand"></div>
  <button onclick="drawCard()">Ambil Kartu</button>
</div>

<script>

let mode="bot";
let players={};
let turnIndex=0;
let direction=1;
let discard={};
let currentColor="";
let myId="player1";
let myTurn=false;

function startBot(){
  const name=document.getElementById("nameInput").value;
  if(!name)return alert("Isi nama!");

  mode="bot";

  players={
    player1:{name:name,hand:generateHand(),bot:false},
    bot2:{name:"Bot A",hand:generateHand(),bot:true},
    bot3:{name:"Bot B",hand:generateHand(),bot:true},
    bot4:{name:"Bot C",hand:generateHand(),bot:true}
  };

  discard=randomCard();
  currentColor=discard.color;

  document.getElementById("loginScreen").style.display="none";
  document.getElementById("game").style.display="block";

  renderAll();
  checkBotTurn();
}

function generateHand(){
  let hand=[];
  for(let i=0;i<7;i++){
    hand.push(randomCard());
  }
  return hand;
}

function randomCard(){
  const colors=["red","blue","green","yellow"];
  const values=["0","1","2","3","4","5","6","7","8","9","+2","R","S"];
  return {
    color:colors[Math.floor(Math.random()*4)],
    value:values[Math.floor(Math.random()*values.length)]
  };
}

function renderAll(){
  renderPlayers();
  renderDiscard();
  renderHand();
}

function renderPlayers(){
  const div=document.getElementById("players");
  div.innerHTML="";
  const ids=Object.keys(players);

  ids.forEach((id,i)=>{
    div.innerHTML+=`
      <div>
        ${players[id].name} (${players[id].hand.length})
        ${i===turnIndex?" ‚Üê Turn":""}
      </div>
    `;
  });
}

function renderDiscard(){
  const div=document.getElementById("discard");
  div.className="card "+discard.color;
  div.innerText=discard.value;
}

function renderHand(){
  const div=document.getElementById("myHand");
  div.innerHTML="";
  players[myId].hand.forEach((card,index)=>{
    div.innerHTML+=`
      <div class="card ${card.color}" onclick="playCard(${index})">
        ${card.value}
      </div>
    `;
  });
}

function playCard(index){
  const ids=Object.keys(players);
  if(ids[turnIndex]!==myId)return;

  let myHand=players[myId].hand;
  const card=myHand[index];

  if(card.color!==currentColor &&
     card.value!==discard.value){
    return alert("Kartu tidak cocok!");
  }

  myHand.splice(index,1);
  discard=card;
  currentColor=card.color;

  nextTurn();
  renderAll();
  checkBotTurn();
}

function drawCard(){
  const ids=Object.keys(players);
  if(ids[turnIndex]!==myId)return;

  players[myId].hand.push(randomCard());
  nextTurn();
  renderAll();
  checkBotTurn();
}

function nextTurn(){
  const total=Object.keys(players).length;
  turnIndex+=direction;
  if(turnIndex>=total)turnIndex=0;
  if(turnIndex<0)turnIndex=total-1;
}

function checkBotTurn(){
  const ids=Object.keys(players);
  const current=ids[turnIndex];

  if(players[current].bot){
    setTimeout(()=>{
      botPlay(current);
    },1000);
  }
}

function botPlay(id){
  let hand=players[id].hand;
  let played=false;

  for(let i=0;i<hand.length;i++){
    if(hand[i].color===currentColor ||
       hand[i].value===discard.value){
      discard=hand[i];
      currentColor=hand[i].color;
      hand.splice(i,1);
      played=true;
      break;
    }
  }

  if(!played){
    hand.push(randomCard());
  }

  nextTurn();
  renderAll();
  checkBotTurn();
}

</script>
</body>
</html>
